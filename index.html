<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HR Training Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-input { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.2); color: white; transition: all 0.3s; }
        .glass-input:focus { border-color: #38bdf8; background: rgba(0, 0, 0, 0.5); outline: none; }
        .nav-active { color: #38bdf8; border-bottom: 2px solid #38bdf8; background: rgba(56, 189, 248, 0.1); }
        .loader { width: 48px; height: 48px; border: 5px solid #FFF; border-bottom-color: #38bdf8; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .custom-checkbox { width: 18px; height: 18px; accent-color: #0ea5e9; cursor: pointer; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden bg-slate-900">

    <nav class="glass sticky top-0 z-50 flex justify-around text-xs font-medium uppercase tracking-wide shadow-lg">
        <button onclick="switchTab('register')" id="nav-register" class="flex-1 py-4 text-slate-400 transition-all nav-active"><i class="fa-solid fa-user-plus text-xl block mb-1"></i> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
        <button onclick="switchTab('checkin')" id="nav-checkin" class="flex-1 py-4 text-slate-400 transition-all"><i class="fa-solid fa-qrcode text-xl block mb-1"></i> ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</button>
        <button onclick="switchTab('admin')" id="nav-admin" class="flex-1 py-4 text-slate-400 transition-all"><i class="fa-solid fa-user-shield text-xl block mb-1"></i> Admin</button>
    </nav>

    <main class="flex-1 overflow-y-auto p-4 relative scroll-smooth pb-20">
        <div id="loadingOverlay" class="hidden fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center">
            <span class="loader mb-4"></span>
            <p class="text-cyan-400 font-bold animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
        </div>

        <section id="page-register" class="max-w-md mx-auto animate-fade-in">
            <div class="glass rounded-2xl p-6 shadow-2xl relative overflow-hidden mt-4">
                <div class="absolute top-0 right-0 w-32 h-32 bg-cyan-500/20 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2"><span class="w-1.5 h-6 bg-cyan-400 rounded-full"></span> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h2>
                <form id="regForm" onsubmit="handleRegister(event)" class="space-y-4">
                    <div class="grid grid-cols-3 gap-3">
                        <div><label class="text-xs text-slate-400 ml-1">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label><select name="prefix" class="w-full p-3 rounded-xl glass-input text-sm"><option class="text-black">‡∏ô‡∏≤‡∏¢</option><option class="text-black">‡∏ô‡∏≤‡∏á</option><option class="text-black">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option></select></div>
                        <div class="col-span-2"><label class="text-xs text-slate-400 ml-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" name="name" required class="w-full p-3 rounded-xl glass-input text-sm" placeholder="‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="text-xs text-slate-400 ml-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label><input type="text" name="nickname" required class="w-full p-3 rounded-xl glass-input text-sm"></div>
                        <div><label class="text-xs text-slate-400 ml-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input type="tel" name="phone" required pattern="[0-9]{10}" class="w-full p-3 rounded-xl glass-input text-sm" placeholder="08xxxxxxxx"></div>
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 ml-1">‡πÅ‡∏ú‡∏ô‡∏Å</label>
                        <select name="dept" class="w-full p-3 rounded-xl glass-input text-sm">
                            <option value="Telesales Product" class="text-black">Telesales Product</option>
                            <option value="Telesales Insurance" class="text-black">Telesales Insurance</option>
                            <option value="Back Office" class="text-black">Back Office</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="text-xs text-slate-400 ml-1">‡∏ó‡∏µ‡∏°</label><input type="text" name="team" class="w-full p-3 rounded-xl glass-input text-sm"></div>
                        <div><label class="text-xs text-slate-400 ml-1">‡∏ú‡∏π‡πâ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</label><input type="text" name="recruiter" class="w-full p-3 rounded-xl glass-input text-sm"></div>
                    </div>
                    <button type="submit" class="w-full mt-4 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold rounded-xl shadow-lg transition transform active:scale-95">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                </form>
            </div>
        </section>

        <section id="page-checkin" class="hidden max-w-md mx-auto mt-4">
            <div class="glass rounded-2xl p-8 text-center shadow-2xl">
                <div class="w-20 h-20 bg-slate-800 rounded-full mx-auto flex items-center justify-center mb-6 border border-slate-700 shadow-inner"><i class="fa-solid fa-fingerprint text-4xl text-cyan-400"></i></div>
                <h2 class="text-xl font-bold text-white mb-2">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏ö‡∏£‡∏°</h2>
                <div class="relative max-w-xs mx-auto mb-6"><input type="tel" id="checkinPhone" class="w-full pl-12 pr-4 py-3 rounded-xl glass-input text-lg tracking-widest text-center" placeholder="08xxxxxxxx"><i class="fa-solid fa-mobile-screen absolute left-4 top-4 text-slate-500 text-lg"></i></div>
                <button onclick="checkStatus()" class="w-full py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-bold transition shadow-lg">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
                <div id="profileCard" class="hidden mt-8 text-left border-t border-slate-700 pt-6 animate-fade-up">
                    <div class="flex justify-between items-start mb-4">
                        <div><h3 class="text-lg font-bold text-cyan-400" id="uiName">...</h3><p class="text-xs text-slate-400"><span id="uiNick">...</span> | <span id="uiDept">...</span></p></div>
                        <span id="uiStatus" class="px-2 py-1 rounded text-[10px] font-bold uppercase bg-green-500/20 text-green-400 border border-green-500/30">Active</span>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div id="boxD1" class="glass p-2 rounded-xl text-center"><span class="text-[10px] text-slate-500 uppercase font-bold block mb-2">Day 1</span><button onclick="doCheckIn(1)" class="w-full h-auto py-2 rounded-lg bg-slate-800 text-slate-400 transition flex items-center justify-center"><i class="fa-solid fa-check"></i></button></div>
                        <div id="boxD2" class="glass p-2 rounded-xl text-center"><span class="text-[10px] text-slate-500 uppercase font-bold block mb-2">Day 2</span><button onclick="doCheckIn(2)" class="w-full h-auto py-2 rounded-lg bg-slate-800 text-slate-400 transition flex items-center justify-center"><i class="fa-solid fa-check"></i></button></div>
                        <div id="boxD3" class="glass p-2 rounded-xl text-center"><span class="text-[10px] text-slate-500 uppercase font-bold block mb-2">Day 3</span><button onclick="doCheckIn(3)" class="w-full h-auto py-2 rounded-lg bg-slate-800 text-slate-400 transition flex items-center justify-center"><i class="fa-solid fa-check"></i></button></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-admin" class="hidden h-full flex flex-col mt-4">
            <div id="adminLogin" class="max-w-xs mx-auto glass p-8 rounded-2xl text-center mt-10">
                <i class="fa-solid fa-lock text-3xl text-red-400 mb-4"></i>
                <h3 class="text-white font-bold mb-4">Admin Access</h3>
                <input type="password" id="adminPass" class="w-full p-3 rounded-xl glass-input text-center mb-4" placeholder="Password">
                <button onclick="adminAccess()" class="w-full py-2 bg-red-600 hover:bg-red-500 text-white rounded-xl font-bold">Login</button>
            </div>
            
            <div id="adminDashboard" class="hidden flex-1 flex flex-col">
                <div class="flex justify-between items-center mb-4 px-2">
                    <h2 class="text-white font-bold text-lg"><i class="fa-solid fa-users-gear mr-2 text-cyan-400"></i>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</h2>
                    <div class="flex gap-2">
                        <button onclick="toggleSelectAll()" class="text-xs bg-slate-700 hover:bg-slate-600 text-white px-3 py-1.5 rounded-lg transition"><i class="fa-solid fa-check-double"></i> All</button>
                        <button onclick="loadAdminData()" class="text-xs bg-slate-700 hover:bg-slate-600 text-white px-3 py-1.5 rounded-lg transition"><i class="fa-solid fa-rotate"></i></button>
                    </div>
                </div>
                
                <div class="flex-1 overflow-auto glass rounded-xl mb-24">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-800 text-slate-400 text-[10px] font-bold uppercase sticky top-0 z-10">
                            <tr>
                                <th class="p-4 w-10 text-center">#</th>
                                <th class="p-4">Name / Team</th>
                                <th class="p-4 text-center hidden md:table-cell">Check-in</th>
                                <th class="p-4 text-center">Status</th>
                                <th class="p-4 text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody id="adminTable" class="divide-y divide-slate-700 text-sm text-slate-300"></tbody>
                    </table>
                </div>

                <div id="actionBar" class="fixed bottom-4 left-4 right-4 bg-slate-800/95 backdrop-blur-md border border-slate-600 rounded-2xl p-4 shadow-2xl transform translate-y-[150%] transition-transform duration-300 z-50 flex justify-between items-center">
                    <div class="text-white text-xs">
                        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <span id="selectedCount" class="text-cyan-400 font-bold text-lg">0</span> ‡∏Ñ‡∏ô
                    </div>
                    <div class="flex gap-2">
                        <button onclick="openReportModal()" class="bg-yellow-500 hover:bg-yellow-400 text-white px-3 py-2 rounded-xl text-sm font-bold shadow-lg flex items-center gap-1">
                            <i class="fa-solid fa-file-invoice"></i> <span class="hidden sm:inline">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
                        </button>
                        <button onclick="openHRModal()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-2 rounded-xl text-sm font-bold shadow-lg flex items-center gap-1">
                            <i class="fa-solid fa-user-tie"></i> <span class="hidden sm:inline">‡∏™‡πà‡∏á HR</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="editModal" class="hidden fixed inset-0 z-[70] bg-black/80 backdrop-blur flex items-center justify-center p-4">
        <div class="glass w-full max-w-sm rounded-2xl p-6 border border-slate-600 max-h-[90vh] overflow-y-auto">
            <h3 class="text-white font-bold text-lg mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            <input type="hidden" id="editRowId">
            <div class="space-y-4">
                <div>
                    <label class="text-xs text-slate-400">‡∏ó‡∏µ‡∏° (Team)</label>
                    <select id="editTeamSelect" onchange="toggleTeamInput(this)" class="w-full mt-1 p-2 rounded-lg bg-slate-800 text-white border border-slate-600 text-sm">
                        <option value="RETAIL 1">RETAIL 1</option><option value="RETAIL 2">RETAIL 2</option><option value="RETAIL 3">RETAIL 3</option><option value="RETAIL 4">RETAIL 4</option>
                        <option value="PA 1A">PA 1A</option><option value="PA 1B">PA 1B</option><option value="PA 1C">PA 1C</option><option value="PA 1D">PA 1D</option>
                        <option value="PA 2A">PA 2A</option><option value="PA 2B">PA 2B</option><option value="PA 2C">PA 2C</option>
                        <option value="OTHER" class="text-yellow-400 font-bold">+ ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á</option>
                    </select>
                    <input type="text" id="editTeamInput" class="hidden w-full mt-2 p-2 rounded-lg bg-slate-700 text-white border border-slate-500 text-sm" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°...">
                </div>
                <div><label class="text-xs text-slate-400">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label><select id="editStatus" class="w-full mt-1 p-2 rounded-lg bg-slate-800 text-white border border-slate-600 text-sm"><option value="Active">Active</option><option value="Passed">Passed</option><option value="Resigned">Resigned</option><option value="New Job">New Job</option><option value="Back Office">Back Office</option><option value="Other">Other</option></select></div>
                <div><label class="text-xs text-slate-400">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label><textarea id="editNote" rows="2" class="w-full mt-1 p-2 rounded-lg bg-slate-800 text-white border border-slate-600 text-sm"></textarea></div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="document.getElementById('editModal').classList.add('hidden')" class="flex-1 py-2 rounded-lg border border-slate-600 text-slate-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="saveAdminEdit()" class="flex-1 py-2 rounded-lg bg-cyan-600 text-white font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <div id="reportModal" class="hidden fixed inset-0 z-[80] bg-black/90 backdrop-blur flex items-center justify-center p-4">
        <div class="glass w-full max-w-md rounded-2xl p-6 border border-slate-600 flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-white font-bold text-lg"><i class="fa-solid fa-file-lines mr-2 text-yellow-500"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏ö‡∏£‡∏°</h3>
                <button onclick="document.getElementById('reportModal').classList.add('hidden')" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto space-y-4 pr-1">
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-xs text-slate-400 block mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏ö‡∏≠‡∏ö‡∏£‡∏°</label><input type="date" id="reportDate" class="w-full p-2 rounded-lg bg-slate-800 text-white border border-slate-600 text-xs"></div>
                    <div><label class="text-xs text-slate-400 block mb-1">‡∏≠‡∏ö‡∏£‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà</label><select id="reportDayType" class="w-full p-2 rounded-lg bg-slate-800 text-white border border-slate-600 text-xs"><option value="‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å">‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å</option><option value="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á</option><option value="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°</option></select></div>
                </div>
                <button onclick="addSelectionToReport()" class="w-full py-3 bg-gradient-to-r from-blue-600 to-cyan-600 rounded-xl text-white font-bold shadow-lg hover:brightness-110 active:scale-95 transition"><i class="fa-solid fa-plus-circle mr-1"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                <div><label class="text-xs text-slate-400 block mb-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label><textarea id="finalReportText" class="w-full h-48 p-3 rounded-xl bg-slate-800 text-white border border-slate-600 text-sm leading-relaxed" spellcheck="false"></textarea></div>
            </div>
            <div class="flex gap-3 mt-4 pt-4 border-t border-slate-700">
                <button onclick="copyToClipboard('finalReportText')" class="flex-1 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl text-white font-bold transition"><i class="fa-regular fa-copy mr-1"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
                <button onclick="sendLine('finalReportText')" class="flex-1 py-3 bg-[#06C755] hover:bg-[#05b54d] rounded-xl text-white font-bold transition"><i class="fa-brands fa-line mr-1 text-lg"></i> ‡∏™‡πà‡∏á LINE</button>
            </div>
        </div>
    </div>

    <div id="hrModal" class="hidden fixed inset-0 z-[80] bg-black/90 backdrop-blur flex items-center justify-center p-4">
        <div class="glass w-full max-w-md rounded-2xl p-6 border border-slate-600 flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-white font-bold text-lg"><i class="fa-solid fa-user-tie mr-2 text-indigo-400"></i>‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ HR</h3>
                <button onclick="document.getElementById('hrModal').classList.add('hidden')" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto space-y-4 pr-1">
                <div class="space-y-3">
                    <div>
                        <label class="text-xs text-slate-400 block mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏ö‡∏£‡∏° (Training Date)</label>
                        <input type="date" id="hrTrainingDate" class="w-full p-3 rounded-xl bg-slate-800 text-white border border-slate-600 text-sm">
                    </div>
                    <div>
                        <label class="text-xs text-cyan-400 font-bold block mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á (Actual Start Date)</label>
                        <input type="date" id="hrWorkDate" class="w-full p-3 rounded-xl bg-slate-800 text-white border border-cyan-500/50 text-sm shadow-lg shadow-cyan-900/20">
                    </div>
                </div>
                
                <button onclick="generateHRReport()" class="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl text-white font-bold shadow-lg hover:brightness-110 active:scale-95 transition mt-2">
                    <i class="fa-solid fa-wand-magic-sparkles mr-1"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                </button>

                <div>
                    <label class="text-xs text-slate-400 block mb-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á</label>
                    <textarea id="hrReportText" class="w-full h-48 p-3 rounded-xl bg-slate-800 text-white border border-slate-600 text-sm leading-relaxed font-mono" spellcheck="false"></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-4 pt-4 border-t border-slate-700">
                <button onclick="copyToClipboard('hrReportText')" class="flex-1 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl text-white font-bold transition"><i class="fa-regular fa-copy mr-1"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
                <button onclick="sendLine('hrReportText')" class="flex-1 py-3 bg-[#06C755] hover:bg-[#05b54d] rounded-xl text-white font-bold transition"><i class="fa-brands fa-line mr-1 text-lg"></i> ‡∏™‡πà‡∏á LINE</button>
            </div>
        </div>
    </div>

    <script>
        // **********************************************
        // üî¥ ‡πÉ‡∏™‡πà URL ‡∏ó‡∏µ‡πà Deploy ‡πÅ‡∏•‡πâ‡∏ß ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        // **********************************************
        const API_URL = "https://script.google.com/macros/s/AKfycbyYYauRspNoRvkhUWKZh4c5Hp1TzhxWGu_T96TvPPMZ6p1DHJqh30Azzi_PrEcGn9dy/exec"; 
        // **********************************************
        
        let adminPassCache = "";
        let adminDataCache = [];
        let selectedRows = new Set(); 

        async function fetchAPI(payload) {
            document.getElementById('loadingOverlay').classList.remove('hidden');
            try {
                const response = await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
                return await response.json();
            } catch (error) { return { status: 'error', message: 'Connection Failed' }; }
            finally { document.getElementById('loadingOverlay').classList.add('hidden'); }
        }

        function switchTab(tab) {
            ['register', 'checkin', 'admin'].forEach(t => {
                document.getElementById(`page-${t}`).classList.add('hidden');
                document.getElementById(`nav-${t}`).classList.remove('nav-active', 'text-cyan-400');
            });
            document.getElementById(`page-${tab}`).classList.remove('hidden');
            document.getElementById(`nav-${tab}`).classList.add('nav-active', 'text-cyan-400');
        }

        // --- Register & Checkin ---
        async function handleRegister(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const res = await fetchAPI({ action: 'register', ...Object.fromEntries(formData) });
            if (res.status === 'success') { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); e.target.reset(); switchTab('checkin'); }
            else { Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', res.message, 'error'); }
        }

        async function checkStatus() {
            const phone = document.getElementById('checkinPhone').value;
            if (!phone) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£', 'warning');
            const res = await fetchAPI({ action: 'login', phone });
            if (res.status === 'success') {
                const d = res.data;
                document.getElementById('uiName').innerText = d.name; document.getElementById('uiNick').innerText = d.nickname; document.getElementById('uiDept').innerText = d.dept; document.getElementById('uiStatus').innerText = d.status;
                document.getElementById('profileCard').classList.remove('hidden');
                ['1','2','3'].forEach(i => updateCheckBtn(`boxD${i}`, i, d[`d${i}`]));
            } else { Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '', 'error'); document.getElementById('profileCard').classList.add('hidden'); }
        }

        function updateCheckBtn(id, day, val) {
            const el = document.getElementById(id); const btn = el.querySelector('button');
            if(val) { el.classList.add('border-green-500/30'); btn.className="w-full h-auto py-2 rounded-lg bg-green-500/20 text-green-400 cursor-default"; btn.innerHTML=`<span class="font-bold text-[10px] whitespace-normal leading-tight">${val}</span>`; btn.onclick=null; }
            else { el.classList.remove('border-green-500/30'); btn.className="w-full h-auto py-2 rounded-lg bg-slate-800 hover:bg-cyan-600 text-slate-400 hover:text-white"; btn.innerHTML=`<i class="fa-solid fa-check"></i>`; btn.onclick=()=>doCheckIn(day); }
        }

        async function doCheckIn(day) {
            const phone = document.getElementById('checkinPhone').value;
            const cf = await Swal.fire({ title: `‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${day}?`, showCancelButton: true, confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô', background: '#1e293b', color: '#fff' });
            if (cf.isConfirmed) {
                const res = await fetchAPI({ action: 'checkin', phone, day });
                if (res.status === 'success') { checkStatus(); Swal.fire({icon:'success', title:'‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', toast:true, position:'top-end', showConfirmButton:false, timer:2000}); }
            }
        }

        // --- Admin Section ---
        async function adminAccess() {
            const pass = document.getElementById('adminPass').value;
            const res = await fetchAPI({ action: 'get_admin', pass });
            if (res.status === 'success') { adminPassCache = pass; document.getElementById('adminLogin').classList.add('hidden'); document.getElementById('adminDashboard').classList.remove('hidden'); renderAdminTable(res.data); }
            else { Swal.fire('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î', '', 'error'); }
        }

        async function loadAdminData() { if(adminPassCache) { const res = await fetchAPI({ action: 'get_admin', pass: adminPassCache }); if(res.status==='success') renderAdminTable(res.data); } }

        function renderAdminTable(data) {
            adminDataCache = data;
            const tbody = document.getElementById('adminTable'); tbody.innerHTML = '';
            data.forEach(row => {
                const tr = document.createElement('tr'); tr.className = "hover:bg-white/5 transition border-b border-slate-700";
                const icon = (v) => v ? `<i class="fa-solid fa-circle-check text-green-400" title="${v}"></i>` : `<i class="fa-regular fa-circle text-slate-600"></i>`;
                let badge = "bg-slate-700 text-slate-300";
                if(row.status==='Active') badge="bg-blue-500/20 text-blue-400"; if(row.status==='Passed') badge="bg-green-500/20 text-green-400"; if(['Resigned','New Job'].includes(row.status)) badge="bg-red-500/20 text-red-400";
                const dateOnly = row.timestamp ? row.timestamp.split(' ')[0] : '-';

                tr.innerHTML = `
                    <td class="p-4 text-center">
                        <input type="checkbox" class="custom-checkbox" value="${row.id}" onchange="toggleRowSelection(this)">
                    </td>
                    <td class="p-4">
                        <div class="font-bold text-white">${row.name}</div>
                        <div class="text-[10px] text-slate-400">${row.nickname} | ${row.dept}</div>
                        <div class="text-[10px] text-cyan-400 font-bold mt-0.5">‡∏ó‡∏µ‡∏°: ${row.team}</div>
                        <div class="text-[10px] text-slate-500 mt-1"><i class="fa-regular fa-calendar mr-1"></i>${dateOnly}</div>
                    </td>
                    <td class="p-4 text-center hidden md:table-cell"><div class="flex justify-center gap-1 text-xs">${icon(row.d1)}${icon(row.d2)}${icon(row.d3)}</div></td>
                    <td class="p-4 text-center"><span class="px-2 py-1 rounded text-[10px] uppercase font-bold ${badge}">${row.status}</span></td>
                    <td class="p-4 text-center flex justify-center gap-2">
                        <button onclick="openEditModal(${row.row}, '${row.status}', '${row.team}', '${row.note||''}')" class="text-cyan-400 bg-cyan-900/30 p-2 rounded-lg hover:bg-cyan-900/50"><i class="fa-solid fa-pen"></i></button>
                        <button onclick="deleteUser(${row.row})" class="text-red-400 bg-red-900/30 p-2 rounded-lg hover:bg-red-900/50"><i class="fa-solid fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            updateActionBar();
        }

        // --- Selection Logic ---
        function toggleRowSelection(checkbox) {
            if (checkbox.checked) selectedRows.add(checkbox.value);
            else selectedRows.delete(checkbox.value);
            updateActionBar();
        }
        function toggleSelectAll() {
            const allCheckboxes = document.querySelectorAll('.custom-checkbox');
            const isAllSelected = selectedRows.size === allCheckboxes.length;
            selectedRows.clear();
            allCheckboxes.forEach(cb => { cb.checked = !isAllSelected; if (!isAllSelected) selectedRows.add(cb.value); });
            updateActionBar();
        }
        function updateActionBar() {
            const count = selectedRows.size;
            document.getElementById('selectedCount').innerText = count;
            const bar = document.getElementById('actionBar');
            if (count > 0) bar.classList.remove('translate-y-[150%]'); else bar.classList.add('translate-y-[150%]');
        }

        // --- GENERAL HELPERS ---
        function copyToClipboard(elementId) {
            let text = document.getElementById(elementId).value;
            if(elementId === 'finalReportText') text += "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö";
            navigator.clipboard.writeText(text).then(() => {
                Swal.fire({ icon: 'success', title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', toast: true, position: 'top-end', showConfirmButton: false, timer: 1500, background: '#1e293b', color: '#fff' });
            });
        }
        function sendLine(elementId) {
            let text = document.getElementById(elementId).value;
            if(elementId === 'finalReportText') text += "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö";
            window.open(`https://line.me/R/msg/text/?${encodeURIComponent(text)}`, '_blank');
        }
        function formatDateThai(date) {
            const months = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];
            const day = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear() + 543;
            return `${day} ${month} ${year}`;
        }
        function parseDateInput(dateStr) {
            if (!dateStr) return null;
            return new Date(dateStr);
        }

        // --- REPORT GENERATOR ---
        function openReportModal() {
            document.getElementById('reportDate').value = new Date().toISOString().split('T')[0];
            const dateStr = formatDateThai(new Date());
            const currentText = document.getElementById('finalReportText').value;
            if(!currentText.trim()) {
                document.getElementById('finalReportText').value = `‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏û‡∏µ‡πà‡∏î‡πâ‡∏≤\n‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á\n‡∏Ç‡∏≠‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà\n‡∏£‡∏≠‡∏ö‡∏≠‡∏ö‡∏£‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${dateStr}\n\n`;
            }
            document.getElementById('reportModal').classList.remove('hidden');
        }

        function addSelectionToReport() {
            const dayType = document.getElementById('reportDayType').value;
            const selectedItems = adminDataCache.filter(item => selectedRows.has(item.id.toString()));
            if (selectedItems.length === 0) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô', 'warning');
            
            const teams = {};
            selectedItems.forEach(item => {
                const t = item.team || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°';
                if (!teams[t]) teams[t] = [];
                teams[t].push(item.nickname);
            });

            let sectionText = `‡∏≠‡∏ö‡∏£‡∏°${dayType} ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${selectedItems.length} ‡∏Ñ‡∏ô\n\n`;
            for (const [teamName, nicks] of Object.entries(teams)) {
                sectionText += `${teamName}    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${nicks.length} ‡∏Ñ‡∏ô ${nicks.join(' ')}\n`;
            }
            sectionText += `\n`; 
            document.getElementById('finalReportText').value += sectionText;
            
            selectedRows.clear();
            document.querySelectorAll('.custom-checkbox').forEach(cb => cb.checked = false);
            updateActionBar();
            Swal.fire({ icon: 'success', title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß', showConfirmButton: false, timer: 1000, background: '#1e293b', color: '#fff' });
        }

        // --- HR REPORT (NEW) ---
        function openHRModal() {
            document.getElementById('hrTrainingDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('hrWorkDate').value = ""; // ‡πÉ‡∏´‡πâ User ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏á
            document.getElementById('hrReportText').value = "";
            document.getElementById('hrModal').classList.remove('hidden');
        }

        function generateHRReport() {
            const trainDateVal = document.getElementById('hrTrainingDate').value;
            const workDateVal = document.getElementById('hrWorkDate').value;
            
            if(!trainDateVal || !workDateVal) {
                return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á', 'warning');
            }

            const trainDateStr = formatDateThai(parseDateInput(trainDateVal));
            const workDateStr = formatDateThai(parseDateInput(workDateVal));

            const selectedItems = adminDataCache.filter(item => selectedRows.has(item.id.toString()));
            if (selectedItems.length === 0) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô', 'warning');

            let report = "";
            selectedItems.forEach(item => {
                report += `${item.prefix || ''}${item.name}\n`;
                report += `${item.nickname}  ${item.team}\n`;
                report += `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏ö‡∏£‡∏° ${trainDateStr}\n`;
                report += `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏ö‡∏£‡∏° ${workDateStr} ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏•‡∏á‡πÅ‡∏ú‡∏ô‡∏Å\n\n`;
            });

            document.getElementById('hrReportText').value = report;
        }

        // --- Edit & Delete (Logic ‡πÄ‡∏î‡∏¥‡∏°) ---
        function toggleTeamInput(select) {
            const input = document.getElementById('editTeamInput');
            if (select.value === 'OTHER') { input.classList.remove('hidden'); input.focus(); } else { input.classList.add('hidden'); }
        }
        function openEditModal(row, status, team, note) {
            document.getElementById('editRowId').value = row;
            document.getElementById('editStatus').value = status;
            document.getElementById('editNote').value = note;
            const select = document.getElementById('editTeamSelect');
            const input = document.getElementById('editTeamInput');
            const options = Array.from(select.options).map(o => o.value);
            if (options.includes(team)) { select.value = team; input.classList.add('hidden'); input.value = ""; }
            else { select.value = 'OTHER'; input.classList.remove('hidden'); input.value = team; }
            document.getElementById('editModal').classList.remove('hidden');
        }
        async function saveAdminEdit() {
            document.getElementById('editModal').classList.add('hidden');
            const select = document.getElementById('editTeamSelect');
            const input = document.getElementById('editTeamInput');
            const finalTeam = select.value === 'OTHER' ? input.value : select.value;
            const res = await fetchAPI({ action: 'admin_update', row: document.getElementById('editRowId').value, team: finalTeam, status: document.getElementById('editStatus').value, note: document.getElementById('editNote').value });
            if(res.status==='success') loadAdminData();
        }
        async function deleteUser(row) {
            const cf = await Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?', text: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£", icon: 'warning', showCancelButton: true, confirmButtonColor: '#ef4444', background: '#1e293b', color: '#fff' });
            if (cf.isConfirmed) { const res = await fetchAPI({ action: 'admin_delete', row: row }); if (res.status === 'success') { loadAdminData(); } }
        }
    </script>
</body>
</html>
